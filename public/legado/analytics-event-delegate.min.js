/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/*
  miuri.js - simple URI parser

  MIT licensed

  Copyright (C) 2014 Radoslaw Mejer, http://github.com/radmen
 */

!function(){var e,t,n;!function(r){function o(e,t){return A.call(e,t)}function i(e,t){var n,r,o,i,a,s,c,u,l,p,f,d,h=t&&t.split("/"),g=E.map,y=g&&g["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,E.nodeIdCompat&&P.test(e[a])&&(e[a]=e[a].replace(P,"")),"."===e[0].charAt(0)&&h&&(d=h.slice(0,h.length-1),e=d.concat(e)),l=0;l<e.length;l++)if("."===(f=e[l]))e.splice(l,1),l-=1;else if(".."===f){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((h||y)&&g){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),h)for(p=h.length;p>0;p-=1)if((o=g[h.slice(0,p).join("/")])&&(o=o[r])){i=o,s=l;break}if(i)break;!c&&y&&y[r]&&(c=y[r],u=l)}!i&&c&&(i=c,s=u),i&&(n.splice(0,s,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=b.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(r,n.concat([e,t]))}}function s(e){return function(t){return i(t,e)}}function c(e){return function(t){m[e]=t}}function u(e){if(o(v,e)){var t=v[e];delete v[e],w[e]=!0,d.apply(r,t)}if(!o(m,e)&&!o(w,e))throw new Error("No "+e);return m[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function p(e){return e?l(e):[]}function f(e){return function(){return E&&E.config&&E.config[e]||{}}}var d,h,g,y,m={},v={},E={},w={},A=Object.prototype.hasOwnProperty,b=[].slice,P=/\.js$/;g=function(e,t){var n,r=l(e),o=r[0],a=t[1];return e=r[1],o&&(o=i(o,a),n=u(o)),o?e=n&&n.normalize?n.normalize(e,s(a)):i(e,a):(e=i(e,a),r=l(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},y={require:function(e){return a(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:f(e)}}},d=function(e,t,n,i){var s,l,f,d,h,E,A,b=[],P=typeof n;if(i=i||e,E=p(i),"undefined"===P||"function"===P){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(d=g(t[h],E),"require"===(l=d.f))b[h]=y.require(e);else if("exports"===l)b[h]=y.exports(e),A=!0;else if("module"===l)s=b[h]=y.module(e);else if(o(m,l)||o(v,l)||o(w,l))b[h]=u(l);else{if(!d.p)throw new Error(e+" missing "+l);d.p.load(d.n,a(i,!0),c(l),{}),b[h]=m[l]}f=n?n.apply(m[e],b):void 0,e&&(s&&s.exports!==r&&s.exports!==m[e]?m[e]=s.exports:f===r&&A||(m[e]=f))}else e&&(m[e]=n)},e=t=h=function(e,t,n,o,i){if("string"==typeof e)return y[e]?y[e](t):u(g(e,p(t)).f);if(!e.splice){if(E=e,E.deps&&h(E.deps,E.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?d(r,e,t,n):setTimeout(function(){d(r,e,t,n)},4),h},h.config=function(e){return h(e)},e._defined=m,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(m,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../node_modules/almond/almond",function(){}),n("modules/constants",{NAMESPACE_PREFIX:"ga-gtm-extension",TYPE_DELEGATED_EVENT:"delegated-event",MODE_GOOGLE_ANALYTICS:"google-analytics",MODE_GOOGLE_TAG_MANAGER:"google-tag-manager",MODE_PARENT_PAGE_DELEGATE:"parent-page",TAG_MOUSE_HOVER:"analytics-hover",TAG_MOUSE_CLICK:"analytics-click",FIRST_PAGE_VIEW_ONLY:"first-view-only",NO:"no",YES:"yes"}),n("modules/CrossFrameMessenger",[],function(){var e=function(e,t,n){this.target=t||null,this.nameSpace="com.ceros-labs."+e,this.callbacks={},void 0!==n&&!1===n||window.addEventListener("message",function(e){try{if(void 0===e.data||void 0===e.source)return void console.error("Malformed message: missing data.");var t=null;try{t=JSON.parse(e.data)}catch(e){}if(null!==t&&t.name===this.nameSpace){if(!t.type||!t.payload)throw new Error("Malformed message");if(this.callbacks[t.type]){var n=t.payload;this.callbacks[t.type].forEach(function(e){e(n)})}}}catch(e){console.error(e)}}.bind(this))};return e.prototype={send:function(e,t){if(null!==this.target){t=t||{};var n={name:this.nameSpace,type:e,payload:t},r=JSON.stringify(n);this.target.postMessage(r,"*")}},receive:function(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},e}),n("modules/analytics/AnalyticsBackend",[],function(){var e=function(e){this.config=e,this.clientId=e.clientId||null,this.initalized=!1};return e.prototype={init:function(){!1===this.initalized&&("function"==typeof this.performInit&&this.performInit(),this.initalized=!0)},setClientId:function(e){this.clientId=e},sendEvent:function(e,t,n){},decoratePageReference:function(e){return e},recordClick:function(e){this.sendEvent(this.config.clickEventAction,e,this.config.eventCategory)},recordHover:function(e){this.sendEvent(this.config.hoverEventAction,e,this.config.eventCategory)},recordPageView:function(e){"function"==typeof this.decoratePageReference&&(e=this.decoratePageReference(e)),this.sendEvent(this.config.viewEventAction,e,this.config.eventCategory)}},e.extend=function(t){t=t||{};var n=function(t){e.call(this,t)};n.prototype=Object.create(e.prototype),n.prototype.constructor=e;for(var r=Object.keys(t),o=0;o<r.length;o++){var i=r[o];n.prototype[i]=t[i]}return n},e}),n("modules/analytics/GoogleAnalytics",["./AnalyticsBackend"],function(e){return e.extend({sendEvent:function(e,t,n){var r=this.config.trackerGlobal;"function"==typeof window[r]?window[r]("send",{hitType:"event",eventCategory:n,eventAction:e,eventLabel:t}):console.log("ga not found.")}})}),n("modules/analytics/GoogleTagManager",["./AnalyticsBackend"],function(e){return e.extend({sendEvent:function(e,t,n){var r={};r.event="ceros-event",r[this.config.eventCategoryParameter]=n,r[this.config.eventActionParameter]=e,r[this.config.eventLabelParameter]=t;var o=this.config.dataLayerGlobal;void 0!==window[o]?window[o].push(r):console.error("dataLayer (as '"+o+"') is undefined")}})}),n("modules/analytics/ParentPageMessenger",["./AnalyticsBackend","../CrossFrameMessenger","../constants"],function(e,t,n){return e.extend({performInit:function(){this.messenger=new t(n.NAMESPACE_PREFIX,window.parent,!1)},sendEvent:function(e,t,r){r=r||this.config.eventCategory||"";var o={eventType:"event",eventCategory:r,eventName:e,eventLabel:t};this.messenger.send(n.TYPE_DELEGATED_EVENT,o)}})}),n("modules/Analytics",["./analytics/GoogleAnalytics","./analytics/GoogleTagManager","./analytics/ParentPageMessenger","./constants"],function(e,t,n,r){return{factory:function(o){var i;return i=o.backEnd&&o.backEnd===r.MODE_GOOGLE_TAG_MANAGER?new t(o):o.backEnd&&o.backEnd===r.MODE_PARENT_PAGE_DELEGATE?new n(o):new e(o),i.init(),i}}}),n("modules/Logger",[],function(){var e=function(e){this.enabled=e};return e.prototype={log:function(e,t){return this.enabled?window.console&&console.log&&Function.apply.call(console.log,console,arguments):null}},e}),n("modules/URIParser",[],function(){var e,t,n,r,o,i,a,s,c,u={}.hasOwnProperty;return c=/^(?:([A-Za-z-+\.]+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/,s=["protocol","username","password","host","port","path","query","fragment"],"undefined"==typeof window||null===window,i=function(e){var t,n,r,o,i,a;if(!c.test(e))throw"Invalid uri";for(n=c.exec(e).slice(1),o={},t=i=0,a=s.length;i<a;t=++i)r=s[t],o[r]=n[t];return o},r=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e){return"[object Object]"===Object.prototype.toString.call(e)},n=function(e,t){var n,r;for(n in t)u.call(t,n)&&(r=t[n],e[n]=r)},a=function(e){var t,n,i,a,s,c,u,l,p,f;for(n=/\[([^\]]*)\]/,t={},p=e.split("&"),u=0,l=p.length;u<l;u++)a=p[u],f=a.split("="),i=f[0],c=f[1],s=n.exec(i),c=decodeURIComponent(c),s?(s[1]&&!o(t[i])?t[i]={}:r(t[i])||(t[i]=[]),s[1]?t[i][s[1]]=c:t[i].push(c)):t[i]=c;return t},t=function(e,t,n){var i,a,s,c;if(null==n&&(n=[]),!r(t)&&!o(t))return e+"="+encodeURIComponent(t);if(r(t))for(s=0,c=t.length;s<c;s++)i=t[s],n.push(e+"[]="+encodeURIComponent(i));if(o(t))for(a in t)u.call(t,a)&&(i=t[a],n.push(e+"["+a+"]="+encodeURIComponent(i)));return n.join("&")},e="/","undefined"!=typeof window&&null!==window&&window.location.host&&(e=window.location.href),function(){function r(t){this.uri=null!=t?t:e,this.parts=i(this.uri),this.parts.query=this.parts.query?a(this.parts.query):{},this.parts.path||(this.parts.path="/")}return r.prototype.retrieve=function(e,t){return null==t&&(t=null),null===t?this.parts[e]:(this.parts[e]=t,this)},r.prototype.protocol=function(e){return this.retrieve("protocol",e)},r.prototype.username=function(e){return this.retrieve("username",e)},r.prototype.password=function(e){return this.retrieve("password",e)},r.prototype.host=function(e){return this.retrieve("host",e)},r.prototype.hostname=function(e){return this.host(e)},r.prototype.port=function(e){return this.retrieve("port",e)},r.prototype.path=function(e){return e&&"/"!==e[0]&&(e="/"+e),this.retrieve("path",e)},r.prototype.query=function(e,t){return e&&"string"==typeof e?t?(this.parts.query[e]=t,this):this.parts.query[e]:o(e)?(n(this.parts.query,e),this):this.parts.query},r.prototype.fragment=function(e){return this.retrieve("fragment",e)},r.prototype.pathinfo=function(){var e,t,n,r,o;return o=this.path(),e=o.split("/").pop(),t=o.replace(new RegExp("/?"+e),""),n=/\./.test(e)?e.split(".").pop():"",r=e.replace(new RegExp("\\."+n+"$"),""),""===t&&(t="/"),{path:o,basename:e,dirname:t,extension:n,filename:r}},r.prototype.toString=function(){var e,n,r,o,i;r="",this.parts.protocol&&this.parts.host&&(r+=this.parts.protocol+"://",this.parts.username&&this.parts.password?r+=this.parts.username+":"+this.parts.password+"@":this.parts.username&&(r+=this.parts.username+"@"),r+=this.parts.host,this.parts.port&&(r+=":"+this.parts.port)),r+=this.parts.path,n=[],i=this.parts.query;for(e in i)u.call(i,e)&&(o=i[e],n.push(t(e,o)));return n.length>0&&(r+="?"+n.join("&")),this.parts.fragment&&(r+="#"+this.parts.fragment),r},r}()}),function(e){"use strict";var n=document.getElementById("ceros-event-delegate"),r=n.getAttribute("src"),o="./";if(r){o=r.split("?")[0].split("/").slice(0,-1).join("/")+"/"}t.config({paths:{modules:o+"modules"}}),t(["./modules/constants","./modules/CrossFrameMessenger","./modules/Analytics","./modules/Logger","./modules/URIParser"],function(e,t,o,i,a){var s=new a(r),c=s.query(),u=n.getAttribute("data-mode")||c.mode||e.MODE_GOOGLE_ANALYTICS,l=n.getAttribute("data-debug")||c.debug||e.NO,p=n.getAttribute("data-ga-tracker")||c.gaTrackerName||"ga",f=n.getAttribute("data-data-layer")||c.dataLayerName||"dataLayer",d=n.getAttribute("data-category-parameter")||c.categoryParameter||"cerosCategory",h=n.getAttribute("data-action-parameter")||c.actionParameter||"cerosAction",g=n.getAttribute("data-label-parameter")||c.labelParameter||"cerosLabel",y=new t(e.NAMESPACE_PREFIX),m=new i(l===e.YES),v=o.factory({backEnd:u,eventCategoryParameter:d,eventActionParameter:h,eventLabelParameter:g,trackerGlobal:p,dataLayerGlobal:f});y.receive(e.TYPE_DELEGATED_EVENT,function(e){var t=e.eventCategory||"",n=e.eventName||"",r=e.eventLabel||"";m.log("Delegated Event: ",[n,r,t]),v.sendEvent(n,r,t)})})}(window),n("analytics-event-delegate.js",function(){})}();