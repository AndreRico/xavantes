/*
  miuri.js - simple URI parser

  MIT licensed

  Copyright (C) 2014 Radoslaw Mejer, http://github.com/radmen
 */

!function(){define("modules/constants",{NAMESPACE_PREFIX:"ga-gtm-extension",TYPE_DELEGATED_EVENT:"delegated-event",MODE_GOOGLE_ANALYTICS:"google-analytics",MODE_GOOGLE_TAG_MANAGER:"google-tag-manager",MODE_PARENT_PAGE_DELEGATE:"parent-page",TAG_MOUSE_HOVER:"analytics-hover",TAG_MOUSE_CLICK:"analytics-click",FIRST_PAGE_VIEW_ONLY:"first-view-only",NO:"no",YES:"yes"}),define("modules/analytics/AnalyticsBackend",[],function(){var e=function(e){this.config=e,this.clientId=e.clientId||null,this.initalized=!1};return e.prototype={init:function(){!1===this.initalized&&("function"==typeof this.performInit&&this.performInit(),this.initalized=!0)},setClientId:function(e){this.clientId=e},sendEvent:function(e,t,n){},decoratePageReference:function(e){return e},recordClick:function(e){this.sendEvent(this.config.clickEventAction,e,this.config.eventCategory)},recordHover:function(e){this.sendEvent(this.config.hoverEventAction,e,this.config.eventCategory)},recordPageView:function(e){"function"==typeof this.decoratePageReference&&(e=this.decoratePageReference(e)),this.sendEvent(this.config.viewEventAction,e,this.config.eventCategory)}},e.extend=function(t){t=t||{};var n=function(t){e.call(this,t)};n.prototype=Object.create(e.prototype),n.prototype.constructor=e;for(var r=Object.keys(t),o=0;o<r.length;o++){var i=r[o];n.prototype[i]=t[i]}return n},e}),define("modules/analytics/GoogleAnalytics",["./AnalyticsBackend"],function(e){return e.extend({sendEvent:function(e,t,n){var r=this.config.trackerGlobal;"function"==typeof window[r]?window[r]("send",{hitType:"event",eventCategory:n,eventAction:e,eventLabel:t}):console.log("ga not found.")}})}),define("modules/analytics/GoogleTagManager",["./AnalyticsBackend"],function(e){return e.extend({sendEvent:function(e,t,n){var r={};r.event="ceros-event",r[this.config.eventCategoryParameter]=n,r[this.config.eventActionParameter]=e,r[this.config.eventLabelParameter]=t;var o=this.config.dataLayerGlobal;void 0!==window[o]?window[o].push(r):console.error("dataLayer (as '"+o+"') is undefined")}})}),define("modules/CrossFrameMessenger",[],function(){var e=function(e,t,n){this.target=t||null,this.nameSpace="com.ceros-labs."+e,this.callbacks={},void 0!==n&&!1===n||window.addEventListener("message",function(e){try{if(void 0===e.data||void 0===e.source)return void console.error("Malformed message: missing data.");var t=null;try{t=JSON.parse(e.data)}catch(e){}if(null!==t&&t.name===this.nameSpace){if(!t.type||!t.payload)throw new Error("Malformed message");if(this.callbacks[t.type]){var n=t.payload;this.callbacks[t.type].forEach(function(e){e(n)})}}}catch(e){console.error(e)}}.bind(this))};return e.prototype={send:function(e,t){if(null!==this.target){t=t||{};var n={name:this.nameSpace,type:e,payload:t},r=JSON.stringify(n);this.target.postMessage(r,"*")}},receive:function(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},e}),define("modules/analytics/ParentPageMessenger",["./AnalyticsBackend","../CrossFrameMessenger","../constants"],function(e,t,n){return e.extend({performInit:function(){this.messenger=new t(n.NAMESPACE_PREFIX,window.parent,!1)},sendEvent:function(e,t,r){r=r||this.config.eventCategory||"";var o={eventType:"event",eventCategory:r,eventName:e,eventLabel:t};this.messenger.send(n.TYPE_DELEGATED_EVENT,o)}})}),define("modules/Analytics",["./analytics/GoogleAnalytics","./analytics/GoogleTagManager","./analytics/ParentPageMessenger","./constants"],function(e,t,n,r){return{factory:function(o){var i;return i=o.backEnd&&o.backEnd===r.MODE_GOOGLE_TAG_MANAGER?new t(o):o.backEnd&&o.backEnd===r.MODE_PARENT_PAGE_DELEGATE?new n(o):new e(o),i.init(),i}}}),define("modules/BrowserDom",[],function(){var e=function(e){this.experience=e,this.allSyncedObjects=null};return e.prototype={getElementByComponentId:function(e){var t=this.getElementFromPageByComponentId(e);return null===t?this.getElementFromSyncedObjectByComponentId(e):t},getElementFromPageByComponentId:function(e){return document.getElementById(e)},getElementFromSyncedObjectByComponentId:function(e){var t=null;return null===this.allSyncedObjects&&(this.allSyncedObjects=this.experience.findAllSyncedObjects()),this.allSyncedObjects.syncedObjects.forEach(function(n){if(null===t){var r=n.id+"|"+e,o=document.getElementById(r);null!==o&&(t=o)}}),t}},e}),define("modules/Logger",[],function(){var e=function(e){this.enabled=e};return e.prototype={log:function(e,t){return this.enabled?window.console&&console.log&&Function.apply.call(console.log,console,arguments):null}},e}),define("modules/URIParser",[],function(){var e,t,n,r,o,i,a,s,c,l={}.hasOwnProperty;return c=/^(?:([A-Za-z-+\.]+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/,s=["protocol","username","password","host","port","path","query","fragment"],"undefined"==typeof window||null===window,i=function(e){var t,n,r,o,i,a;if(!c.test(e))throw"Invalid uri";for(n=c.exec(e).slice(1),o={},t=i=0,a=s.length;i<a;t=++i)r=s[t],o[r]=n[t];return o},r=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e){return"[object Object]"===Object.prototype.toString.call(e)},n=function(e,t){var n,r;for(n in t)l.call(t,n)&&(r=t[n],e[n]=r)},a=function(e){var t,n,i,a,s,c,l,u,d,p;for(n=/\[([^\]]*)\]/,t={},d=e.split("&"),l=0,u=d.length;l<u;l++)a=d[l],p=a.split("="),i=p[0],c=p[1],s=n.exec(i),c=decodeURIComponent(c),s?(s[1]&&!o(t[i])?t[i]={}:r(t[i])||(t[i]=[]),s[1]?t[i][s[1]]=c:t[i].push(c)):t[i]=c;return t},t=function(e,t,n){var i,a,s,c;if(null==n&&(n=[]),!r(t)&&!o(t))return e+"="+encodeURIComponent(t);if(r(t))for(s=0,c=t.length;s<c;s++)i=t[s],n.push(e+"[]="+encodeURIComponent(i));if(o(t))for(a in t)l.call(t,a)&&(i=t[a],n.push(e+"["+a+"]="+encodeURIComponent(i)));return n.join("&")},e="/","undefined"!=typeof window&&null!==window&&window.location.host&&(e=window.location.href),function(){function r(t){this.uri=null!=t?t:e,this.parts=i(this.uri),this.parts.query=this.parts.query?a(this.parts.query):{},this.parts.path||(this.parts.path="/")}return r.prototype.retrieve=function(e,t){return null==t&&(t=null),null===t?this.parts[e]:(this.parts[e]=t,this)},r.prototype.protocol=function(e){return this.retrieve("protocol",e)},r.prototype.username=function(e){return this.retrieve("username",e)},r.prototype.password=function(e){return this.retrieve("password",e)},r.prototype.host=function(e){return this.retrieve("host",e)},r.prototype.hostname=function(e){return this.host(e)},r.prototype.port=function(e){return this.retrieve("port",e)},r.prototype.path=function(e){return e&&"/"!==e[0]&&(e="/"+e),this.retrieve("path",e)},r.prototype.query=function(e,t){return e&&"string"==typeof e?t?(this.parts.query[e]=t,this):this.parts.query[e]:o(e)?(n(this.parts.query,e),this):this.parts.query},r.prototype.fragment=function(e){return this.retrieve("fragment",e)},r.prototype.pathinfo=function(){var e,t,n,r,o;return o=this.path(),e=o.split("/").pop(),t=o.replace(new RegExp("/?"+e),""),n=/\./.test(e)?e.split(".").pop():"",r=e.replace(new RegExp("\\."+n+"$"),""),""===t&&(t="/"),{path:o,basename:e,dirname:t,extension:n,filename:r}},r.prototype.toString=function(){var e,n,r,o,i;r="",this.parts.protocol&&this.parts.host&&(r+=this.parts.protocol+"://",this.parts.username&&this.parts.password?r+=this.parts.username+":"+this.parts.password+"@":this.parts.username&&(r+=this.parts.username+"@"),r+=this.parts.host,this.parts.port&&(r+=":"+this.parts.port)),r+=this.parts.path,n=[],i=this.parts.query;for(e in i)l.call(i,e)&&(o=i[e],n.push(t(e,o)));return n.length>0&&(r+="?"+n.join("&")),this.parts.fragment&&(r+="#"+this.parts.fragment),r},r}()}),function(){"use strict";var e=document.getElementById("ceros-ga-plugin"),t=e.getAttribute("src"),n="./";if(t){n=t.split("?")[0].split("/").slice(0,-1).join("/")+"/"}console.log(n),require.config({paths:{CerosSDK:"//sdk.ceros.com/standalone-player-sdk-v5.min",modules:n+"modules"}}),require(["CerosSDK","modules/constants","modules/Analytics","modules/BrowserDom","modules/Logger","modules/URIParser"],function(n,r,o,i,a,s){var c=new s(t),l=c.query(),u=e.getAttribute("data-mode")||l.mode||r.MODE_GOOGLE_ANALYTICS,d=e.getAttribute("data-tracking-id")||l.trackingId||null,p=e.getAttribute("data-category-parameter")||l.categoryParameter||"cerosCategory",f=e.getAttribute("data-action-parameter")||l.actionParameter||"cerosAction",g=e.getAttribute("data-label-parameter")||l.labelParameter||"cerosLabel",h=e.getAttribute("data-event-category")||l.eventCategory||"ceros event",y=e.getAttribute("data-view-event-action")||l.viewEventAction||"ceros view",v=e.getAttribute("data-click-event-action")||l.clickEventAction||"ceros click",m=e.getAttribute("data-hover-event-action")||l.hoverEventAction||"ceros hover",E=e.getAttribute("data-ga-tracker")||l.gaTrackerName||"ga",A=e.getAttribute("data-data-layer")||l.dataLayerName||"dataLayer",b=e.getAttribute("data-debug")||l.debug||r.NO,w=e.getAttribute("data-hover-tag")||l.hoverTag||r.TAG_MOUSE_HOVER,C=e.getAttribute("data-click-tag")||l.clickTag||r.TAG_MOUSE_CLICK,O=e.getAttribute("data-record-page-views")||l.recordPageViews||r.NO,P=new a(b===r.YES),_=[],G=o.factory({trackingId:d,backEnd:u,logger:P,trackerGlobal:E,dataLayerGlobal:A,eventCategoryParameter:p,eventActionParameter:f,eventLabelParameter:g,eventCategory:h,viewEventAction:y,clickEventAction:v,hoverEventAction:m});n.findExperience().fail(function(e){console.error(e)}).done(function(e){var t=new i(e),o=e.findComponentsByTag(w),a=e.findComponentsByTag(C),s=function(){o.components.forEach(function(e){if(-1===_.indexOf(e.id)){var n=t.getElementByComponentId(e.id);null!==n&&(P.log("Ceros Extension found new element for hover: #",e.id),n.addEventListener("mouseenter",function(){P.log("Ceros Extension fired hover event for: #",e.id),G.recordHover(e.getPayload())}),_.push(e.id))}})};if(e.on(n.EVENTS.PAGE_CHANGING,s),s(e.getCurrentPage()),a.on(n.EVENTS.CLICKED,function(e){P.log("Ceros Extension fired click event for: #",e.id),G.recordClick(e.getPayload())}),O!==r.NO){var c=null,l=function(e){if((O!==r.FIRST_PAGE_VIEW_ONLY||null===c)&&c!==e.pageNumber){var t,n=e.getPayload();t=""===n?"page "+e.pageNumber:n,P.log("Ceros Extension fired page event for: ",t),G.recordPageView(t),c=e.pageNumber}};e.on(n.EVENTS.PAGE_CHANGED,l),l(e.getCurrentPage())}})})}(),define("ga-and-gtm-extension.js",function(){})}();